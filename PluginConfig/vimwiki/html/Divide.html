<script type="text/javascript" src="scripts/shCore.js"></script>
<link type="text/css" rel="stylesheet" href="styles/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>

<script type="text/javascript" src="scripts/shBrushverilog.js"></script>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<link rel="Stylesheet" type="text/css" href="style.css">
<title>Divide</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>

<h1 id="toc_1">偶数分频</h1>
<pre clase = "brush : verilog">
`timescale  1ns/1ps 
`define     DELAY   1 
module ClkDivideEven   #
(
    parameter    TDDR = 10 
)
(
    Clk,
    RSTn,
    pClkOut
);
input               Clk ;
input               RSTn ;
output              pClkOut ;
reg                 pClkOut ;

reg     [7:0]       rClkCount ;
always @(posedge Clk or negedge RSTn)
begin
    if(~RSTn)
    begin
        pClkOut          &lt;=#`DELAY 0 ;
        rClkCount        &lt;=#`DELAY 0 ;
    end
    else
    begin
        if (rClkCount == TDDR/2-1)
        begin
            pClkOut      &lt;=#`DELAY ~pClkOut ;
            rClkCount    &lt;=#`DELAY 0 ;
        end
        else
            rClkCount    &lt;=#`DELAY rClkCount + 1 ;
    end
end
endmodule
</pre>
  
<h1 id="toc_2">奇数分频</h1>
<pre clase = "brush : verilog">
`timescale  1ns/1ps 
`define     DELAY   1

//-------------------------------------------------------------------------
//Odd frequency division
//duty = 50
//-------------------------------------------------------------------------
module ClkDivideOdd     #
(
    parameter    TDDR = 5 
)
(
    CLK,
    RSTn,

    pClkOut,
);

input       CLK ; 
input       RSTn;
output      pClkOut;

reg [7:0]   rCntPositive ;
reg [7:0]   rCntNegative;

reg         rClkPositive ;
reg         rClkNegative ;

always @ (posedge CLK or negedge RSTn)
begin

    if(~RSTn)     
        rCntPositive    &lt;=#`DELAY 0;
    else if(rCntPositive == TDDR-1)    
        rCntPositive    &lt;=#`DELAY 0;
    else 
        rCntPositive    &lt;=#`DELAY rCntPositive + 1;

end

always @ (posedge CLK or negedge RSTn)
begin
    if(~RSTn) 
        rClkPositive    &lt;=#`DELAY 0;
    else if(rCntPositive == (TDDR-1)/2)
        rClkPositive    &lt;=#`DELAY ~rClkPositive;
    else if(rCntPositive==TDDR-1)
        rClkPositive    &lt;=#`DELAY ~rClkPositive;
end

always @ (negedge CLK or negedge RSTn)
begin
    if(~RSTn)     
        rCntNegative    &lt;=#`DELAY 0;
    else if(rCntNegative == TDDR-1)    
        rCntNegative    &lt;=#`DELAY 0;
    else 
        rCntNegative    &lt;=#`DELAY rCntNegative + 1;
end

always @ (negedge CLK or negedge RSTn)
begin
    if(~RSTn) 
        rClkNegative    &lt;=#`DELAY 0;
    else if(rCntNegative == (TDDR-1)/2)
        rClkNegative    &lt;=#`DELAY ~rClkNegative;
    else if(rCntNegative == TDDR-1)
        rClkNegative    &lt;=#`DELAY ~rClkNegative;
end

assign pClkOut = rClkPositive | rClkNegative;

endmodule
</pre>
  
<h1 id="toc_3">Testbench</h1>
<pre clase = "brush : verilog">
`timescale  1ns/1ps 
`define     DELAY   1 

module  test_tb();
reg         Clk;
reg         RSTn;
wire        pClkOut;

initial
begin
    Clk  = 0 ;
    HarwareReset ;
end

always  #10     Clk = ~Clk ;

parameter   TDDR = 10 ;

task HarwareReset ;
    begin
        RSTn = 1'b1;
        wait (Clk !== 1'bx);
        @ (negedge Clk);
        RSTn &lt;= 1'b0;
        @ (negedge Clk);
        @ (negedge Clk);
        RSTn &lt;= 1'b1;
    end
endtask

ClkDivideEven 
#(
    .TDDR       (    TDDR       )
)
ClkDivideEvenEx01
(
    .Clk        (    Clk        ),
    .RSTn       (    RSTn       ),
    .pClkOut    (    pClkOut    )
);
endmodule
</pre>

</body>
</html>

